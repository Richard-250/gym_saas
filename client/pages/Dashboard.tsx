import React, { useState } from 'react';
import { useAuth } from '@/contexts/AuthContext';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { Progress } from '@/components/ui/progress';
import { 
  Dumbbell, 
  Heart, 
  Calendar, 
  Bell, 
  Settings, 
  Users, 
  DollarSign, 
  Activity, 
  Zap,\n  TrendingUp,\n  TrendingDown,\n  Clock,\n  CheckCircle,\n  AlertCircle,\n  XCircle,\n  Plus,\n  X,\n  CreditCard,\n  FileText,\n  UserPlus,\n  LogIn\n} from 'lucide-react';\nimport { generateSampleDashboardStats, generateSampleMembers, generateSampleTasks, generateSamplePayments, generateSampleNotifications } from '@/lib/sample-data';\nimport { Link } from 'react-router-dom';\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, ResponsiveContainer } from 'recharts';\n\nexport const Dashboard: React.FC = () => {\n  const { user, currentGym, logout, setCurrentGym, userGyms } = useAuth();\n  const [notifications, setNotifications] = useState(generateSampleNotifications('user-1', currentGym?.id || 'gym-1'));\n  \n  const stats = generateSampleDashboardStats();\n  const members = generateSampleMembers(currentGym?.id || 'gym-1');\n  const tasks = generateSampleTasks(currentGym?.id || 'gym-1');\n  const payments = generateSamplePayments(currentGym?.id || 'gym-1');\n\n  const dismissNotification = (notificationId: string) => {\n    setNotifications(prev => prev.filter(n => n.id !== notificationId));\n  };\n\n  const dismissAllNotifications = () => {\n    setNotifications([]);\n  };\n\n  if (!currentGym) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">No Gym Selected</h1>\n          <p className=\"text-muted-foreground mb-4\">Please select a gym to view the dashboard.</p>\n          <Button asChild>\n            <Link to=\"/gyms\">Select Gym</Link>\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-sidebar\">\n      {/* Sidebar */}\n      <div className=\"fixed left-0 top-0 h-full w-16 bg-sidebar border-r border-sidebar-border flex flex-col items-center py-4 space-y-6\">\n        {/* Logo */}\n        <div className=\"w-10 h-10 bg-primary rounded-lg flex items-center justify-center\">\n          <Heart className=\"h-6 w-6 text-primary-foreground\" />\n        </div>\n        \n        {/* Navigation Icons */}\n        <div className=\"flex flex-col space-y-4\">\n          <Button variant=\"ghost\" size=\"icon\" className=\"w-10 h-10 text-sidebar-foreground hover:bg-sidebar-accent\">\n            <Calendar className=\"h-5 w-5\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"w-10 h-10 text-sidebar-foreground hover:bg-sidebar-accent\">\n            <Users className=\"h-5 w-5\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"w-10 h-10 text-sidebar-foreground hover:bg-sidebar-accent\">\n            <Activity className=\"h-5 w-5\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"w-10 h-10 text-sidebar-foreground hover:bg-sidebar-accent\">\n            <DollarSign className=\"h-5 w-5\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"w-10 h-10 text-sidebar-foreground hover:bg-sidebar-accent\">\n            <Dumbbell className=\"h-5 w-5\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"w-10 h-10 text-sidebar-foreground hover:bg-sidebar-accent\">\n            <FileText className=\"h-5 w-5\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"w-10 h-10 text-sidebar-foreground hover:bg-sidebar-accent\">\n            <Bell className=\"h-5 w-5\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" className=\"w-10 h-10 text-sidebar-foreground hover:bg-sidebar-accent\">\n            <Settings className=\"h-5 w-5\" />\n          </Button>\n        </div>\n        \n        {/* User Avatar */}\n        <div className=\"mt-auto\">\n          <Avatar className=\"h-10 w-10\">\n            <AvatarImage src={user?.avatar} alt={user?.name} />\n            <AvatarFallback>{user?.name?.charAt(0)}</AvatarFallback>\n          </Avatar>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"ml-16 p-6 text-sidebar-foreground\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div>\n            <div className=\"flex items-center space-x-2 mb-2\">\n              <h1 className=\"text-2xl font-bold text-sidebar-foreground\">Dashboard</h1>\n              <Badge variant=\"outline\" className=\"text-warning border-warning\">\n                {currentGym.subscription.planType}\n              </Badge>\n            </div>\n            <p className=\"text-lg text-sidebar-foreground\">{currentGym.name}</p>\n            <p className=\"text-sm text-sidebar-foreground/70\">payments this month</p>\n          </div>\n          <div className=\"flex items-center space-x-4\">\n            <Button variant=\"outline\" className=\"border-sidebar-border\" asChild>\n              <Link to=\"/gyms\">Switch Gym</Link>\n            </Button>\n            <Button variant=\"outline\" onClick={logout}>Sign Out</Button>\n          </div>\n        </div>\n\n        {/* Trial Warning */}\n        {currentGym.subscription.planType === 'trial' && (\n          <div className=\"bg-warning/20 border border-warning rounded-lg p-4 mb-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-2\">\n                <AlertCircle className=\"h-5 w-5 text-warning\" />\n                <span className=\"text-warning font-medium\">\n                  You are currently on the free plan. Please upgrade your account to fully use our software\n                </span>\n              </div>\n              <Button className=\"bg-warning text-warning-foreground hover:bg-warning/90\">\n                UPGRADE\n              </Button>\n            </div>\n          </div>\n        )}\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\n          {/* Left Column */}\n          <div className=\"lg:col-span-1 space-y-6\">\n            {/* Circular Progress Stats */}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <Card className=\"bg-card\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex flex-col items-center\">\n                    <div className=\"relative w-16 h-16 mb-2\">\n                      <Progress value={66.7} className=\"h-2\" />\n                      <div className=\"absolute inset-0 flex items-center justify-center\">\n                        <span className=\"text-lg font-bold\">66.7%</span>\n                      </div>\n                    </div>\n                    <p className=\"text-xs text-center text-muted-foreground\">Scheduled</p>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card className=\"bg-card\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex flex-col items-center\">\n                    <div className=\"relative w-16 h-16 mb-2\">\n                      <Progress value={88.2} className=\"h-2\" />\n                      <div className=\"absolute inset-0 flex items-center justify-center\">\n                        <span className=\"text-lg font-bold\">88.2%</span>\n                      </div>\n                    </div>\n                    <p className=\"text-xs text-center text-muted-foreground\">Paid</p>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card className=\"bg-card\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex flex-col items-center\">\n                    <div className=\"relative w-16 h-16 mb-2\">\n                      <Progress value={75.0} className=\"h-2\" />\n                      <div className=\"absolute inset-0 flex items-center justify-center\">\n                        <span className=\"text-lg font-bold\">75.0%</span>\n                      </div>\n                    </div>\n                    <p className=\"text-xs text-center text-muted-foreground\">Overdue</p>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card className=\"bg-card\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex flex-col items-center\">\n                    <div className=\"relative w-16 h-16 mb-2\">\n                      <Progress value={35.0} className=\"h-2\" />\n                      <div className=\"absolute inset-0 flex items-center justify-center\">\n                        <span className=\"text-lg font-bold\">35.0%</span>\n                      </div>\n                    </div>\n                    <p className=\"text-xs text-center text-muted-foreground\">Attendance</p>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Stats Cards */}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <Card className=\"bg-card\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center space-x-2 mb-2\">\n                    <Users className=\"h-4 w-4 text-primary\" />\n                    <span className=\"text-xs text-muted-foreground\">Total Members</span>\n                  </div>\n                  <p className=\"text-2xl font-bold\">{stats.totalMembers}</p>\n                  <div className=\"flex items-center space-x-1 text-xs\">\n                    <TrendingUp className=\"h-3 w-3 text-success\" />\n                    <span className=\"text-success\">+{stats.memberGrowth}% from last month</span>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card className=\"bg-card\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center space-x-2 mb-2\">\n                    <DollarSign className=\"h-4 w-4 text-primary\" />\n                    <span className=\"text-xs text-muted-foreground\">Monthly Revenue</span>\n                  </div>\n                  <p className=\"text-2xl font-bold\">${stats.monthlyRevenue.toLocaleString()}</p>\n                  <div className=\"flex items-center space-x-1 text-xs\">\n                    <TrendingUp className=\"h-3 w-3 text-success\" />\n                    <span className=\"text-success\">+{stats.revenueGrowth}% from last month</span>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card className=\"bg-card\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center space-x-2 mb-2\">\n                    <Activity className=\"h-4 w-4 text-primary\" />\n                    <span className=\"text-xs text-muted-foreground\">Active Sessions</span>\n                  </div>\n                  <p className=\"text-2xl font-bold\">{stats.activeSessions}</p>\n                  <div className=\"flex items-center space-x-1 text-xs\">\n                    <TrendingUp className=\"h-3 w-3 text-success\" />\n                    <span className=\"text-success\">+{stats.sessionGrowth}% from last month</span>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card className=\"bg-card\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center space-x-2 mb-2\">\n                    <Zap className=\"h-4 w-4 text-primary\" />\n                    <span className=\"text-xs text-muted-foreground\">Equipment Usage</span>\n                  </div>\n                  <p className=\"text-2xl font-bold\">{stats.equipmentUsage}%</p>\n                  <div className=\"flex items-center space-x-1 text-xs\">\n                    <TrendingDown className=\"h-3 w-3 text-destructive\" />\n                    <span className=\"text-destructive\">{stats.usageGrowth}% from last month</span>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n\n          {/* Center Column */}\n          <div className=\"lg:col-span-2 space-y-6\">\n            {/* Attendance Chart */}\n            <Card className=\"bg-card\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <TrendingUp className=\"h-5 w-5\" />\n                  <span>Attendances</span>\n                  <Badge variant=\"secondary\">Last 7 Days</Badge>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ResponsiveContainer width=\"100%\" height={200}>\n                  <BarChart data={stats.attendanceData}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"day\" />\n                    <YAxis />\n                    <Bar dataKey=\"count\" fill=\"hsl(var(--primary))\" />\n                  </BarChart>\n                </ResponsiveContainer>\n              </CardContent>\n            </Card>\n\n            {/* Notifications */}\n            <Card className=\"bg-card\">\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"flex items-center space-x-2\">\n                    <Bell className=\"h-5 w-5\" />\n                    <span>Notifications</span>\n                    {notifications.length > 0 && (\n                      <Badge variant=\"destructive\">{notifications.length}</Badge>\n                    )}\n                  </CardTitle>\n                  {notifications.length > 0 && (\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\" \n                      onClick={dismissAllNotifications}\n                    >\n                      DISMISS ALL\n                    </Button>\n                  )}\n                </div>\n              </CardHeader>\n              <CardContent>\n                {notifications.length === 0 ? (\n                  <p className=\"text-muted-foreground text-center py-4\">No new notifications</p>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {notifications.map((notification) => (\n                      <div \n                        key={notification.id} \n                        className=\"flex items-start space-x-3 p-3 bg-muted/30 rounded-lg\"\n                      >\n                        <div className=\"w-2 h-2 bg-warning rounded-full mt-2\" />\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm font-medium\">{notification.title}</p>\n                          <p className=\"text-xs text-muted-foreground mt-1\">\n                            {notification.message}\n                          </p>\n                        </div>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"icon\" \n                          className=\"h-6 w-6\"\n                          onClick={() => dismissNotification(notification.id)}\n                        >\n                          <X className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* My Bookings */}\n            <Card className=\"bg-card\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Calendar className=\"h-5 w-5\" />\n                  <span>My Bookings</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"text-sm\">\n                    <p className=\"font-medium\">1:30PM</p>\n                    <p className=\"text-muted-foreground\">JL 1/1</p>\n                  </div>\n                  \n                  <div>\n                    <h4 className=\"font-medium mb-2\">Schedule Today</h4>\n                    <div className=\"bg-muted/30 p-3 rounded-lg\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center space-x-2\">\n                          <CheckCircle className=\"h-4 w-4 text-success\" />\n                          <span className=\"text-sm\">6:00PM</span>\n                        </div>\n                        <Badge className=\"bg-success text-success-foreground\">CHECK-IN</Badge>\n                      </div>\n                      <p className=\"text-sm text-muted-foreground mt-1\">Senior Ciri-on<br />Tony second</p>\n                    </div>\n                  </div>\n                  \n                  <div>\n                    <h4 className=\"font-medium mb-2\">Upcoming</h4>\n                    <div className=\"space-y-2\">\n                      <div className=\"text-sm\">\n                        <p className=\"font-medium\">7:00PM Starting</p>\n                        <p className=\"text-muted-foreground\">Senior Sensi</p>\n                      </div>\n                      <div className=\"text-sm\">\n                        <p className=\"font-medium\">9:00PM Judo - AUL move</p>\n                        <p className=\"text-muted-foreground\">VH 1</p>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div className=\"pt-2\">\n                    <p className=\"text-sm font-medium\">Total Sessions Today: 4</p>\n                    <div className=\"flex items-center space-x-4 text-xs mt-1\">\n                      <span className=\"flex items-center space-x-1\">\n                        <div className=\"w-2 h-2 bg-primary rounded-full\" />\n                        <span>In Progress</span>\n                      </span>\n                      <span className=\"flex items-center space-x-1\">\n                        <div className=\"w-2 h-2 bg-muted-foreground rounded-full\" />\n                        <span>Upcoming</span>\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Right Column */}\n          <div className=\"lg:col-span-1 space-y-6\">\n            {/* Quick Actions */}\n            <Card className=\"bg-card\">\n              <CardHeader>\n                <CardTitle>Quick Actions</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <Button className=\"h-20 flex flex-col space-y-2\">\n                    <UserPlus className=\"h-6 w-6\" />\n                    <span className=\"text-xs\">Add Member</span>\n                  </Button>\n                  <Button className=\"h-20 flex flex-col space-y-2\">\n                    <LogIn className=\"h-6 w-6\" />\n                    <span className=\"text-xs\">Check In</span>\n                  </Button>\n                  <Button className=\"h-20 flex flex-col space-y-2\">\n                    <CreditCard className=\"h-6 w-6\" />\n                    <span className=\"text-xs\">New Payment</span>\n                  </Button>\n                  <Button className=\"h-20 flex flex-col space-y-2\">\n                    <FileText className=\"h-6 w-6\" />\n                    <span className=\"text-xs\">View Reports</span>\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Overdue Payments */}\n            <Card className=\"bg-card\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <AlertCircle className=\"h-5 w-5 text-warning\" />\n                  <span>Overdue payments</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {payments.map((payment) => (\n                    <div key={payment.id} className=\"flex items-center space-x-3 p-3 bg-destructive/10 border border-destructive/20 rounded-lg\">\n                      <Avatar className=\"h-8 w-8\">\n                        <AvatarFallback>CR</AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium\">CYRUANIRO Richard</p>\n                        <p className=\"text-xs text-muted-foreground\">{payment.description}</p>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"text-sm font-bold text-destructive\">${payment.amount}</p>\n                        <p className=\"text-xs text-destructive\">13/04/2025</p>\n                      </div>\n                      <Button variant=\"outline\" size=\"icon\" className=\"h-6 w-6\">\n                        <FileText className=\"h-3 w-3\" />\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* My Tasks */}\n            <Card className=\"bg-card\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <CheckCircle className=\"h-5 w-5 text-primary\" />\n                  <span>My tasks</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {tasks.map((task) => (\n                    <div key={task.id} className=\"space-y-2\">\n                      <div className=\"flex items-center space-x-2\">\n                        <CheckCircle className=\"h-4 w-4 text-primary\" />\n                        <span className=\"text-sm font-medium\">{task.title}</span>\n                        <span className=\"text-xs text-destructive ml-auto\">Due Jun 17, 12:00pm</span>\n                      </div>\n                      <p className=\"text-xs text-muted-foreground pl-6\">\n                        Visitor: Niyomugabo Fidela\n                      </p>\n                      <p className=\"text-xs text-muted-foreground pl-6\">\n                        Note<br />\n                        {task.description}\n                      </p>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n